<form
  hx-post="/dashboard/update-project/{{ project.uuid }}"
  hx-target="this"
  hx-swap="innerHTML"
  class="space-y-4"
>
  <!-- Title (Multi-language Support) -->
  <div>
    <label for="title-en" class="block text-sm font-medium text-gray-700"
      >{{ _("title_english") }}</label
    >
    <input
      type="text"
      id="title-en"
      name="title[en]"
      value="{{ project.title.en }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    />
  </div>
  <div>
    <label for="title-ar" class="block text-sm font-medium text-gray-700"
      >{{ _("title_arabic") }}</label
    >
    <input
      type="text"
      id="title-ar"
      name="title[ar]"
      value="{{ project.title.ar }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    />
  </div>

  <!-- Author (Name and Email) -->
  <div>
    <label for="author-name-en" class="block text-sm font-medium text-gray-700"
      >{{ _("author_name_en") }}</label
    >
    <input
      type="text"
      id="author-name-en"
      name="author[name][en]"
      value="{{ project.author.name.en }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    />
  </div>
  <div>
    <label for="author-name-ar" class="block text-sm font-medium text-gray-700"
      >{{ _("author_name_ar") }}</label
    >
    <input
      type="text"
      id="author-name-ar"
      name="author[name][ar]"
      value="{{ project.author.name.ar }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    />
  </div>
  <div>
    <label for="author-email" class="block text-sm font-medium text-gray-700"
      >{{ _("author_email") }}</label
    >
    <input
      type="email"
      id="author-email"
      name="author[email]"
      value="{{ project.author.email }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    />
  </div>

  <!-- Status -->
  <div>
    <label for="status" class="block text-sm font-medium text-gray-700"
      >{{ _("status") }}</label
    >
    <select
      id="status"
      name="status"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      required
    >
      <option
        value="ongoing"
        {% if project.status=="ongoing" %}selected{% endif %}
      >
        {{ _("ongoing") }}
      </option>
      <option
        value="completed"
        {% if project.status=="completed" %}selected{% endif %}
      >
        {{ _("completed") }}
      </option>
    </select>
  </div>

  <!-- Date of Completion -->
  <div>
    <label
      for="date-of-completion"
      class="block text-sm font-medium text-gray-700"
      >{{ _("date_of_completion") }}</label
    >
    <input
      type="date"
      id="date-of-completion"
      name="date_of_completion"
      value="{{ project.date_of_completion }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
    />
  </div>

  <!-- Tags (Multi-language Support) -->
  <div>
    <label for="tags-en" class="block text-sm font-medium text-gray-700"
      >{{ _("tags_english") }}</label
    >
    <input
      type="text"
      id="tags-en"
      name="tags[en]"
      value="{{ project.tags.en }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
    />
  </div>
  <div>
    <label for="tags-ar" class="block text-sm font-medium text-gray-700"
      >{{ _("tags_arabic") }}</label
    >
    <input
      type="text"
      id="tags-ar"
      name="tags[ar]"
      value="{{ project.tags.ar }}"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
    />
  </div>

  <!-- Hero Image -->
  <div>
    <label for="hero-image" class="block text-sm font-medium text-gray-700"
      >{{ _("hero_image") }}</label
    >
    <input
      type="file"
      id="hero-image"
      name="hero_image"
      class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
    />
  </div>

  <!-- Content -->
  <div id="contents" class="space-y-6">
    {% if project.content|length == 0 %}
    <div class="flex justify-end gap-2">
      <button
        type="button"
        class="p-2 bg-green-700 rounded-full hover:bg-green-800 transition-colors add-template"
      >
        <img
          class="size-6"
          src="{{ url_for('static', filename='icons/add.svg') }}"
          alt="{{ _('Add another content block') }}"
        />
      </button>
      <span>{{ _("Add Content") }}</span>
    </div>
    {% endif %} {% for content in project.content %}
    <div class="bg-white shadow-sm rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-medium text-gray-900 mb-4">
        {{ _("Content") }} {{ loop.index }}
      </h3>
      <div class="space-y-4">
        <!-- English Content -->
        <div>
          <label
            for="content-en-{{ loop.index0 }}"
            class="block text-sm font-medium text-gray-700"
            >{{ _("English Content") }}</label
          >
          <textarea
            id="content-en-{{ loop.index0 }}"
            name="content[{{ loop.index0 }}][en]"
            rows="3"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          >
            {{ content.get('en', '') }}
          </textarea>
        </div>
        <!-- Arabic Content -->
        <div>
          <label
            for="content-ar-{{ loop.index0 }}"
            class="block text-sm font-medium text-gray-700"
            >{{ _("Arabic Content") }}</label
          >
          <textarea
            id="content-ar-{{ loop.index0 }}"
            name="content[{{ loop.index0 }}][ar]"
            rows="3"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          >
            {{ content.get('ar', '') }}
          </textarea>
        </div>
        <!-- Image Upload -->
        <div>
          <label
            for="content-image-{{ loop.index0 }}"
            class="block text-sm font-medium text-gray-700"
            >{{ _("Content Image") }}</label
          >
          <input
            type="file"
            id="content-image-{{ loop.index0 }}"
            name="content_image[{{ loop.index0 }}]"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
      </div>
      <!-- Action Buttons -->
      <div class="mt-4 flex justify-end gap-2">
        <button
          type="button"
          class="p-2 bg-green-700 rounded-full hover:bg-green-800 transition-colors add-template"
        >
          <img
            class="size-6"
            src="{{ url_for('static', filename='icons/add.svg') }}"
            alt="{{ _('Add another content block') }}"
          />
        </button>
        <button
          type="button"
          class="p-2 bg-red-700 rounded-full hover:bg-red-800 transition-colors remove-template"
        >
          <img
            class="size-6"
            src="{{ url_for('static', filename='icons/remove.svg') }}"
            alt="{{ _('Remove this content block') }}"
          />
        </button>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Template for Additional Content Blocks -->
  <template id="content-template">
    <div class="bg-white shadow-sm rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-medium text-gray-900 mb-4">
        {{ _("Content") }} <span class="content-index"></span>
      </h3>
      <div class="space-y-4">
        <!-- English Content -->
        <div>
          <label
            for="content-en"
            class="block text-sm font-medium text-gray-700"
            >{{ _("English Content") }}</label
          >
          <textarea
            name="content[en]"
            rows="3"
            placeholder="{{ _('content_english_placeholder') }}"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          ></textarea>
        </div>
        <!-- Arabic Content -->
        <div>
          <label
            for="content-ar"
            class="block text-sm font-medium text-gray-700"
            >{{ _("Arabic Content") }}</label
          >
          <textarea
            name="content[ar]"
            rows="3"
            placeholder="{{ _('content_arabic_placeholder') }}"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          ></textarea>
        </div>
        <!-- Image Upload -->
        <div>
          <label
            for="content-image"
            class="block text-sm font-medium text-gray-700"
            >{{ _("content_image") }}</label
          >
          <input
            type="file"
            name="content_image"
            class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
      </div>
      <!-- Action Buttons -->
      <div class="mt-4 flex justify-end gap-2">
        <button
          type="button"
          class="p-2 bg-green-700 rounded-full hover:bg-green-800 transition-colors add-template"
        >
          <img
            class="size-6"
            src="{{ url_for('static', filename='icons/add.svg') }}"
            alt="{{ _('Add another content block') }}"
          />
        </button>
        <button
          type="button"
          class="p-2 bg-red-700 rounded-full hover:bg-red-800 transition-colors remove-template"
        >
          <img
            class="size-6"
            src="{{ url_for('static', filename='icons/remove.svg') }}"
            alt="{{ _('Remove this content block') }}"
          />
        </button>
      </div>
    </div>
  </template>

<!-- Testimonials -->
<div class="space-y-6">
  {% if project.testimonials|length == 0 %}
  <div class="bg-white shadow-sm rounded-lg p-6 border border-gray-200 text-center">
    <p class="text-gray-700">{{ _("No testimonials added yet.") }}</p>
    <button
      id="add-testimonial"
      type="button"
      class="mt-4 w-full p-4 bg-green-700 text-white rounded-lg hover:bg-green-800 transition-colors"
      onclick="addTestimonialBlock()"
    >
      <span class="flex items-center justify-center gap-2">
        <img
          class="size-6"
          src="{{ url_for('static', filename='icons/add.svg') }}"
          alt="{{ _('Add a testimonial') }}"
        />
        {{ _("Add Testimonial") }}
      </span>
    </button>
  </div>
  {% else %}
  {% for testimonial in project.testimonials %}
  <div class="bg-white shadow-sm rounded-lg p-6 border border-gray-200 relative">
    <!-- Remove Button -->
    <button
      type="button"
      class="absolute top-4 right-4 p-2 bg-red-700 text-white rounded-full hover:bg-red-800 transition-colors"
      onclick="removeTestimonialBlock(this)"
    >
      <img
        class="size-4"
        src="{{ url_for('static', filename='icons/remove.svg') }}"
        alt="{{ _('Remove this testimonial') }}"
      />
    </button>

    <h3 class="text-lg font-medium text-gray-900 mb-4">{{ _("Testimonial") }} {{ loop.index }}</h3>

    <!-- English Testimonial -->
    <div class="mb-4">
      <label
        for="testimonial-en-{{ loop.index }}"
        class="block text-sm font-medium text-gray-700"
        >{{ _("English Testimonial") }}</label
      >
      <textarea
        id="testimonial-en-{{ loop.index }}"
        name="testimonials[{{ loop.index }}][en]"
        rows="3"
        placeholder="{{ _('Enter English testimonial here...') }}"
        class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      >{{ testimonial.get('en', '') }}</textarea>
    </div>

    <!-- Arabic Testimonial -->
    <div class="mb-4">
      <label
        for="testimonial-ar-{{ loop.index }}"
        class="block text-sm font-medium text-gray-700"
        >{{ _("Arabic Testimonial") }}</label
      >
      <textarea
        id="testimonial-ar-{{ loop.index }}"
        name="testimonials[{{ loop.index }}][ar]"
        rows="3"
        placeholder="{{ _('Enter Arabic testimonial here...') }}"
        class="mt-1 block w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500"
      >{{ testimonial.get('ar', '') }}</textarea>
    </div>
  </div>
  {% endfor %}
  {% endif %}

  <!-- Add More Button -->
  <button
    id="add-more-testimonial"
    type="button"
    class="w-full p-4 bg-green-700 text-white rounded-lg hover:bg-green-800 transition-colors"
    onclick="addTestimonialBlock()"
  >
    <span class="flex items-center justify-center gap-2">
      <img
        class="size-6"
        src="{{ url_for('static', filename='icons/add.svg') }}"
        alt="{{ _('Add another testimonial') }}"
      />
      {{ _("Add Another Testimonial") }}
    </span>
  </button>
</div>

  <!-- Submit Button -->
  <div>
    <button
      type="submit"
      class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500"
    >
      {{ _("update_project") }}
    </button>
  </div>
</form>
{% block scripts %}
<script>
  (function () {
    let nodes = [];
    let nodeCount = "{{ project.content|length }}";
    let container = document.getElementById("contents");
    const template = document.getElementById("content-template");

    const add = (template) => (evt) => {
      nodeCount++;
      const clone = template.content.cloneNode(true);
      nodes.push(clone);
      clone
        .querySelector(".add-template")
        .addEventListener("click", add(template));
      clone.querySelector(".remove-template").addEventListener("click", remove);
      for (let i = 0; i < nodes.length; i++) {
        const elem = nodes[i].querySelector("div");
        if (elem && !elem.hasAttribute("id")) {
          elem.setAttribute("id", i);
          elem
            .querySelector('textarea[name="content[ar]"]')
            .setAttribute("name", `content[${i}][ar]`);
          elem
            .querySelector('textarea[name="content[en]"]')
            .setAttribute("name", `content[${i}][en]`);
          elem
            .querySelector('input[name="content_image"]')
            .setAttribute("name", `content_image[${i}]`);
          elem.querySelector(".content-index").textContent = i + 1;
        }
      }
      container.appendChild(clone);
      const secondToLast = container.children[container.children.length - 2];
      secondToLast.querySelector(".add-template").classList.add("hidden");
    };

    const remove = (evt) => {
      nodeCount--;
      const id = parseInt(
        evt.currentTarget.parentElement.parentElement.getAttribute("id"),
      );
      const container = document.getElementById("contents");
      nodes[id] = null;
      evt.currentTarget.parentElement.parentElement.remove();
      if (nodeCount == 1) {
        if (container.children[2]) {
          container.children[2]
            .querySelector(".add-template")
            .classList.remove("hidden");
        }
      } else if (nodeCount == 0) {
        nodes = [];
        container.children[0]
          .querySelector(".add-template")
          .classList.remove("hidden");
      }
    };

    document.querySelectorAll(".add-template").forEach((button) => {
      button.addEventListener("click", add(template));
    });

    document.querySelectorAll(".remove-template").forEach((button) => {
      button.addEventListener("click", remove);
    });



  })();

    // Function to add a new testimonial block
    function addTestimonialBlock() {
    const container = document.querySelector("#testimonials");
    const template = document.getElementById("testimonial-template").content.cloneNode(true);
    const index = container.children.length + 1;

    // Update the index in the title
    template.querySelector("h3").textContent = `Testimonial ${index}`;

    // Update the textarea names
    template.querySelector('textarea[name="testimonials[en]"]').name = `testimonials[${index}][en]`;
    template.querySelector('textarea[name="testimonials[ar]"]').name = `testimonials[${index}][ar]`;

    // Add event listener to the remove button
    template.querySelector("button[onclick='removeTestimonialBlock(this)']").addEventListener("click", () => {
      removeTestimonialBlock(template);
    });

    container.appendChild(template);
  }

  // Function to remove a testimonial block
  function removeTestimonialBlock(button) {
    const block = button.closest(".bg-white");
    block.remove();
  }
</script>
{% endblock %}

